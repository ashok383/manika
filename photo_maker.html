<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MANIK-A-RNIKA | Marriage Bureau Photo Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:15px;
  background:linear-gradient(120deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb);
  background-size:400% 400%;
  animation:bg 15s ease infinite;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.app{
  width:100%;
  max-width:540px;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(18px);
  border-radius:26px;
  padding:22px;
  color:#fff;
  box-shadow:0 15px 40px rgba(0,0,0,.35);
}

h2{text-align:center;margin-bottom:15px}

.controls{display:flex;flex-direction:column;gap:12px}

.upload{
  background:linear-gradient(135deg,#00c6ff,#0072ff);
  padding:14px;
  border-radius:18px;
  text-align:center;
  font-weight:600;
  cursor:pointer;
}
.upload input{display:none}

.color{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(255,255,255,.3);
  padding:10px 14px;
  border-radius:16px;
}

canvas{
  display:block;
  margin:15px auto;
  max-width:100%;
  border-radius:22px;
  box-shadow:0 12px 30px rgba(0,0,0,.35);
}

.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  font-size:15px;
  font-weight:700;
  color:#fff;
  cursor:pointer;
  margin-top:8px;
}
.photo{background:linear-gradient(135deg,#f7971e,#ffd200)}
.sheet{background:linear-gradient(135deg,#00f260,#0575e6)}
</style>
</head>

<body>
<div class="app">
<h2>üíç Marriage Bureau Photo Tool</h2>

<div class="controls">
  <label class="upload">
    üì∏ Upload Photo
    <input type="file" id="upload" accept="image/*">
  </label>

  <div class="color">
    <span>üé® Background</span>
    <input type="color" id="bgColor" value="#ffffff">
  </div>
</div>

<canvas id="photoCanvas"></canvas>
<button class="btn photo" onclick="downloadPhoto()">‚¨á Download Photo (HQ JPEG)</button>

<canvas id="sheetCanvas"></canvas>
<button class="btn sheet" onclick="downloadSheet()">‚¨á Download 8-Copy Sheet</button>
</div>

<!-- AI BACKGROUND REMOVAL -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

<script>
const upload = document.getElementById("upload");
const bgColor = document.getElementById("bgColor");
const photoCanvas = document.getElementById("photoCanvas");
const sheetCanvas = document.getElementById("sheetCanvas");

let img = null;
let sheet = null;

/* 35x45 mm passport/marriage size @300DPI */
const PW = Math.round(35 / 25.4 * 300);
const PH = Math.round(45 / 25.4 * 300);

/* Upload */
upload.onchange = async e => {
  img = await createImageBitmap(e.target.files[0]);
  segmenter.send({image: img});
};

/* AI Segmentation */
const segmenter = new SelfieSegmentation({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${f}`
});
segmenter.setOptions({modelSelection:1});

/* Result */
segmenter.onResults(res=>{
  if(!img) return;

  const temp = document.createElement("canvas");
  temp.width = PW;
  temp.height = PH;
  const ctx = temp.getContext("2d");

  ctx.fillStyle = bgColor.value;
  ctx.fillRect(0,0,PW,PH);

  ctx.drawImage(img,0,0,PW,PH);
  ctx.globalCompositeOperation="destination-in";
  ctx.drawImage(res.segmentationMask,0,0,PW,PH);
  ctx.globalCompositeOperation="source-over";

  drawRounded(temp,photoCanvas);
  sheet = makeSheet(photoCanvas);
  previewSheet();
});

/* Rounded photo */
function drawRounded(src,dst){
  dst.width=src.width;
  dst.height=src.height;
  const c=dst.getContext("2d");
  c.clearRect(0,0,dst.width,dst.height);

  c.beginPath();
  c.moveTo(20,0);
  c.arcTo(dst.width,0,dst.width,dst.height,20);
  c.arcTo(dst.width,dst.height,0,dst.height,20);
  c.arcTo(0,dst.height,0,0,20);
  c.arcTo(0,0,dst.width,0,20);
  c.closePath();
  c.clip();
  c.drawImage(src,0,0);
}

/* 8 copies (2x4) */
function makeSheet(photo){
  const rows=2, cols=4, gap=20, margin=30;
  const c=document.createElement("canvas");
  c.width=cols*photo.width+(cols-1)*gap+margin*2;
  c.height=rows*photo.height+(rows-1)*gap+margin*2;

  const x=c.getContext("2d");
  x.fillStyle="#fff";
  x.fillRect(0,0,c.width,c.height);

  for(let r=0;r<rows;r++)
    for(let i=0;i<cols;i++)
      x.drawImage(photo,
        margin+i*(photo.width+gap),
        margin+r*(photo.height+gap));

  return c;
}

/* Preview */
function previewSheet(){
  sheetCanvas.width=sheet.width;
  sheetCanvas.height=sheet.height;
  sheetCanvas.getContext("2d").drawImage(sheet,0,0);
}

/* Downloads */
function downloadPhoto(){
  const a=document.createElement("a");
  a.download="Marriage_Photo_HQ.jpg";
  a.href=photoCanvas.toDataURL("image/jpeg",0.98);
  a.click();
}
function downloadSheet(){
  const a=document.createElement("a");
  a.download="Marriage_Photo_8_Copy.jpg";
  a.href=sheet.toDataURL("image/jpeg",0.98);
  a.click();
}
</script>
</body>
</html>
