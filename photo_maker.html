<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>(MANIK-A-RNIKA) Photo Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  min-height:100vh;
  font-family:'Segoe UI',sans-serif;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px;
  background: linear-gradient(120deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb);
  background-size:400% 400%;
  animation: gradientBG 15s ease infinite;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
.app{
  position:relative;
  background:rgba(255,255,255,0.22);
  backdrop-filter:blur(18px);
  border-radius:32px;
  padding:35px;
  width:min(1200px,95%);
  box-shadow:0 30px 70px rgba(0,0,0,0.45);
  color:#fff;
}
header{text-align:center;margin-bottom:25px;}
header h2{
  font-size:2.2em;
  background:linear-gradient(90deg,#ff9a9e,#fad0c4,#a18cd1,#fbc2eb);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:25px;
  justify-content:center;
  margin-bottom:25px;
}
.controls div{display:flex;flex-direction:column;min-width:220px;}
button{
  padding:18px 40px;
  border:none;
  border-radius:35px;
  cursor:pointer;
  font-weight:bold;
  color:#fff;
  font-size:18px;
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
}
button.process{background:linear-gradient(90deg,#ff4d4d,#ff1a1a);}
button.preview{background:linear-gradient(90deg,#4dff88,#1aff55);}
.work-area{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:30px;
}
canvas{
  display:block;
  margin:15px auto;
  border-radius:15px;
  box-shadow:0 15px 40px rgba(0,0,0,0.35);
}
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:flex-start;
  padding:15px;
}
.modal-content{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(20px);
  border-radius:20px;
  padding:20px;
  max-width:95%;
  width:700px;
  color:#fff;
}
.close{float:right;font-size:24px;cursor:pointer;}
</style>
</head>

<body>

<div class="app">
<header><h2>(MANIK-A-RNIKA) Photo Tool</h2></header>

<div class="controls">
  <div>
    <label>Upload Photo</label>
    <input type="file" id="upload" accept="image/*">
  </div>
  <div>
    <label>Select Background Color</label>
    <input type="color" id="bgColor" value="#ffffff">
  </div>
  <div>
    <button class="process" onclick="processImage()">Process Photo</button>
  </div>
</div>

<div class="work-area">
  <div>
    <h3>35 × 45 mm Photo</h3>
    <canvas id="photoCanvas"></canvas>
  </div>
  <div>
    <h3>6 × 4 Sheet (8 Copies)</h3>
    <button class="preview" onclick="openModal()">Preview & Download</button>
  </div>
</div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">✖</span>
    <h3>6 × 4 Inch Photo Sheet</h3>
    <canvas id="sheetCanvas"></canvas>
    <br><br>
    <button class="preview" onclick="downloadSheet()">Download Sheet</button>
  </div>
</div>

<script>
const upload = document.getElementById("upload");
const bgColorInput = document.getElementById("bgColor");
const photoCanvas = document.getElementById("photoCanvas");
const sheetCanvas = document.getElementById("sheetCanvas");
const modal = document.getElementById("modal");

const ctx = photoCanvas.getContext("2d");
const sheetCtx = sheetCanvas.getContext("2d");
let img = new Image();

upload.onchange = e => {
  const r = new FileReader();
  r.onload = () => img.src = r.result;
  r.readAsDataURL(e.target.files[0]);
};

const mmToPx = mm => Math.round(mm * 11.81);

function processImage(){
  const w = mmToPx(35);
  const h = mmToPx(45);
  photoCanvas.width = w;
  photoCanvas.height = h;

  ctx.drawImage(img,0,0,w,h);
  removeBackground(bgColorInput.value);
  roundPhoto(15);
  drawBorder();
  createSheet();
}

function removeBackground(hex){
  const imgData = ctx.getImageData(0,0,photoCanvas.width,photoCanvas.height);
  const d = imgData.data;
  const bg = hexToRgb(hex);
  const tolerance = 80;

  for(let i=0;i<d.length;i+=4){
    const dist = Math.sqrt(
      (d[i]-bg.r)**2 +
      (d[i+1]-bg.g)**2 +
      (d[i+2]-bg.b)**2
    );
    if(dist < tolerance) d[i+3] = 0;
  }
  ctx.putImageData(imgData,0,0);
}

function hexToRgb(hex){
  const n = parseInt(hex.slice(1),16);
  return {r:(n>>16)&255,g:(n>>8)&255,b:n&255};
}

function roundPhoto(r){
  const temp=document.createElement("canvas");
  temp.width=photoCanvas.width;
  temp.height=photoCanvas.height;
  temp.getContext("2d").drawImage(photoCanvas,0,0);

  ctx.clearRect(0,0,photoCanvas.width,photoCanvas.height);
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(r,0);
  ctx.lineTo(photoCanvas.width-r,0);
  ctx.quadraticCurveTo(photoCanvas.width,0,photoCanvas.width,r);
  ctx.lineTo(photoCanvas.width,photoCanvas.height-r);
  ctx.quadraticCurveTo(photoCanvas.width,photoCanvas.height,photoCanvas.width-r,photoCanvas.height);
  ctx.lineTo(r,photoCanvas.height);
  ctx.quadraticCurveTo(0,photoCanvas.height,0,photoCanvas.height-r);
  ctx.lineTo(0,r);
  ctx.quadraticCurveTo(0,0,r,0);
  ctx.closePath();
  ctx.clip();
  ctx.drawImage(temp,0,0);
  ctx.restore();
}

function drawBorder(){
  ctx.lineWidth=14;
  ctx.strokeStyle="#000";
  ctx.strokeRect(7,7,photoCanvas.width-14,photoCanvas.height-14);
}

function createSheet(){
  sheetCanvas.width=1800;
  sheetCanvas.height=1200;
  sheetCtx.fillStyle="#fff";
  sheetCtx.fillRect(0,0,1800,1200);

  let x=40,y=40;
  for(let r=0;r<2;r++){
    for(let c=0;c<4;c++){
      sheetCtx.drawImage(photoCanvas,x,y);
      x+=photoCanvas.width+20;
    }
    x=40;
    y+=photoCanvas.height+20;
  }
}

function openModal(){modal.style.display="flex";}
function closeModal(){modal.style.display="none";}
function downloadSheet(){
  const a=document.createElement("a");
  a.download="photosheet_6x4.png";
  a.href=sheetCanvas.toDataURL();
  a.click();
}
</script>

</body>
</html>
