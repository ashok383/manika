<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI HD Image Enhancer</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #fff;
    text-align: center;
    padding: 40px;
}
h1 { margin-bottom: 20px; }
.box {
    background: #1e293b;
    padding: 20px;
    border-radius: 10px;
    display: inline-block;
}
input, select, button {
    margin: 10px;
    padding: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
}
button {
    background: #22c55e;
    cursor: pointer;
}
button:hover { background: #16a34a; }
canvas {
    margin-top: 20px;
    max-width: 100%;
    border: 1px solid #334155;
}
</style>
</head>
<body>

<h1>AI HD Image Enhancer</h1>

<div class="box">
    <input type="file" id="upload" accept="image/*"><br>
    <select id="scale">
        <option value="2">2× HD</option>
        <option value="4">4× Ultra HD</option>
    </select><br>
    <button onclick="enhance()">Enhance Image</button>
    <button onclick="download()">Download</button>
</div>

<br>
<canvas id="canvas"></canvas>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.8.0/dist/tf.min.js"></script>
<!-- ESRGAN pre-trained model for browser (simplified demo) -->
<script src="https://cdn.jsdelivr.net/gh/xinntao/ESRGAN/tfjs-esrgan.js"></script>

<script>
let img = new Image();
let enhancedCanvas = document.getElementById("canvas");
let enhancedDataUrl = "";

document.getElementById("upload").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
});

async function enhance() {
    if (!img.src) {
        alert("Please upload an image first!");
        return;
    }

    const scale = parseInt(document.getElementById("scale").value);
    const ctx = enhancedCanvas.getContext("2d");

    // Show processing message
    ctx.clearRect(0, 0, enhancedCanvas.width, enhancedCanvas.height);
    ctx.font = "24px Arial";
    ctx.fillStyle = "#fff";
    ctx.fillText("Enhancing with AI...", 20, 50);

    // Wait for image to load
    await img.decode();

    // Draw original image to temporary canvas
    const tempCanvas = document.createElement("canvas");
    tempCanvas.width = img.width;
    tempCanvas.height = img.height;
    const tempCtx = tempCanvas.getContext("2d");
    tempCtx.drawImage(img, 0, 0);

    // Run ESRGAN upscale in browser
    // Using tfjs-esrgan simplified demo
    const model = await ESRGAN.load(); // load pre-trained model
    const tensor = tf.browser.fromPixels(tempCanvas);
    const upscaled = await model.upscale(tensor, scale); // upscale factor 2 or 4
    await tf.browser.toPixels(upscaled, enhancedCanvas);
    tensor.dispose();
    upscaled.dispose();

    // Save result as data URL for download
    enhancedDataUrl = enhancedCanvas.toDataURL("image/png");
}

function download() {
    if (!enhancedDataUrl) {
        alert("Please enhance the image first!");
        return;
    }
    const link = document.createElement("a");
    link.download = "enhanced-image.png";
    link.href = enhancedDataUrl;
    link.click();
}
</script>

</body>
</html>
